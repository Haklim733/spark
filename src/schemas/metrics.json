{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Comprehensive Job and Batch Metrics Schema for ELT Pipeline",
  "description": "Schema capturing ALL metrics from HybridLogger: job-level, batch-level, operation-level, performance, business events, errors, and custom metrics",
  "schema_version": "v2",
  "type": "object",
  "properties": {
    "job_id": {
      "type": "string",
      "description": "Job/process identifier from HybridLogger"
    },
    "batch_id": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9_-]+$",
      "description": "Unique batch identifier within the job"
    },
    "source": {
      "type": "string",
      "enum": ["local", "minio", "s3", "hdfs", "api"],
      "description": "Source system identifier"
    },
    "target_table": {
      "type": "string",
      "description": "Target table name for the batch load"
    },
    "version": {
      "type": "string",
      "description": "Schema/process version for compatibility tracking"
    },
    
    "job_start": {
      "type": "string",
      "format": "date-time",
      "description": "When the entire job/application started (HybridLogger start_time)"
    },
    "job_end": {
      "type": "string",
      "format": "date-time",
      "description": "When the entire job/application completed (HybridLogger shutdown)"
    },
    
    "batch_start": {
      "type": "string",
      "format": "date-time",
      "description": "When this specific batch processing started"
    },
    "batch_end": {
      "type": "string",
      "format": "date-time",
      "description": "When this specific batch processing completed"
    },
    
    "operation_name": {
      "type": "string",
      "description": "Name of the operation being tracked (from HybridLogger start_operation/end_operation)"
    },
    "operation_start": {
      "type": "string",
      "format": "date-time",
      "description": "When the operation started"
    },
    "operation_end": {
      "type": "string",
      "format": "date-time",
      "description": "When the operation completed"
    },
    "operation_result_count": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of results from the operation"
    },
    
    "files_processed": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of files attempted to process in this batch"
    },
    "files_loaded": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of files successfully loaded into the target table"
    },
    "files_failed": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of files that failed to load"
    },
    "files_missing": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of files that were expected but not found"
    },
    
    "total_records_processed": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of individual records processed across all files"
    },
    "total_records_loaded": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of individual records successfully loaded"
    },
    "total_records_failed": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of individual records that failed to load"
    },
    "total_records_missing": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of individual records that were expected but not found"
    },
    
    "total_file_size_bytes": {
      "type": "integer",
      "minimum": 0,
      "description": "Total size of all files processed in bytes"
    },
    "bytes_transferred": {
      "type": "integer",
      "minimum": 0,
      "description": "Total bytes transferred/processed"
    },
    "performance_operation": {
      "type": "string",
      "description": "Operation name from performance metrics (HybridLogger log_performance)"
    },
    "performance_execution_time_ms": {
      "type": "integer",
      "minimum": 0,
      "description": "Execution time from performance metrics"
    },
    "performance_timestamp": {
      "type": "integer",
      "minimum": 0,
      "description": "Timestamp from performance metrics"
    },
    
    "business_events_count": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of business events logged (HybridLogger log_business_event)"
    },
    "business_event_types": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Types of business events encountered"
    },
    
    "error_count": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of errors logged (HybridLogger log_error)"
    },
    "error_codes": {
      "type": "object",
      "additionalProperties": {
        "type": "integer",
        "minimum": 0
      },
      "description": "Distribution of error codes encountered during load"
    },
    "error_summary": {
      "type": "string",
      "description": "Human-readable summary of load results"
    },
    "error_types": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Types of errors encountered"
    },
    
    "custom_metrics_count": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of custom metrics logged (HybridLogger log_custom_metrics)"
    },
    "custom_operation_names": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Names of custom operations tracked"
    },
    
    "total_logs_generated": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of log entries generated (HybridLogger get_performance_summary)"
    },
    "async_logging_enabled": {
      "type": "boolean",
      "description": "Whether async logging was enabled"
    },
    
    "validation_status": {
      "type": "string",
      "enum": ["complete_success", "partial_load", "load_failures", "unknown"],
      "description": "Overall validation status of the batch"
    },
    "job_status": {
      "type": "string",
      "enum": ["success", "failed", "partial_success"],
      "description": "Overall job status"
    },
    
    "created_by": {
      "type": "string",
      "description": "User/system that initiated the load"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "When the record was inserted into this table"
    }
  },
  "required": [
    "job_id",
    "batch_id",
    "source",
    "target_table",
    "version",
    "job_start",
    "job_end",
    "batch_start",
    "batch_end",
    "files_processed",
    "files_loaded",
    "files_failed",
    "files_missing",
    "total_records_processed",
    "total_records_loaded",
    "total_records_failed",
    "total_records_missing",
    "total_file_size_bytes",
    "bytes_transferred",
    "error_codes",
    "error_summary",
    "validation_status",
    "job_status",
    "created_by",
    "created_at"
  ],
  "definitions": {
    "error_code": {
      "type": "string",
      "enum": [
        "E001",
        "E002", 
        "E003",
        "E004",
        "E005",
        "E006",
        "E007",
        "E999"
      ],
      "description": "Standardized error codes: E001=FILE_NOT_FOUND, E002=PERMISSION_DENIED, E003=INVALID_FORMAT, E004=SCHEMA_MISMATCH, E005=NETWORK_ERROR, E006=TIMEOUT, E007=MEMORY_ERROR, E999=UNKNOWN_ERROR"
    }
  }
} 