{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Batch Metrics Schema for ELT Pipeline",
  "description": "Schema for batch-level metrics in ELT pipeline. Focuses on load status, performance, and operational metrics without arbitrary quality scores.",
  "schema_version": "v1",
  "type": "object",
  "properties": {
    "job_id": {
      "type": "string",
      "description": "Job/process identifier for operational tracking"
    },
    "batch_id": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9_-]+$",
      "description": "Unique batch identifier for tracking and reprocessing"
    },
    "batch_start_time": {
      "type": "string",
      "format": "date-time",
      "description": "When batch processing started"
    },
    "batch_end_time": {
      "type": "string",
      "format": "date-time",
      "description": "When batch processing completed"
    },
    "source": {
      "type": "string",
      "enum": ["local", "minio", "s3", "hdfs", "api"],
      "description": "Source system identifier"
    },
    "target_table": {
      "type": "string",
      "description": "Target table name for the batch load"
    },
    "files_processed": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of files attempted to process in this batch (operational metric)"
    },
    "files_loaded": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of files successfully loaded into the target table (operational metric)"
    },
    "files_failed": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of files that failed to load due to file system, format, or access issues (operational metric)"
    },
    "files_missing": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of files that were expected but not found or accessible (operational metric)"
    },
    "files_successful": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of files that loaded successfully (same as files_loaded, operational metric)"
    },
    "total_records_processed": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of individual records/data rows processed across all files (data quality metric)"
    },
    "total_records_loaded": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of individual records successfully loaded into the target table (data quality metric)"
    },
    "total_records_failed": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of individual records that failed to load due to schema validation, data quality, or business rule violations (data quality metric)"
    },
    "total_records_missing": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of individual records that were expected but not found or were empty/null (data quality metric)"
    },
    "batch_duration_ms": {
      "type": "integer",
      "minimum": 0,
      "description": "Batch processing duration in milliseconds"
    },
    "total_file_size_bytes": {
      "type": "integer",
      "minimum": 0,
      "description": "Total size of all files processed in bytes"
    },

    "error_codes": {
      "type": "object",
      "additionalProperties": {
        "type": "integer",
        "minimum": 0
      },
      "description": "Distribution of error codes encountered during load"
    },
    "error_summary": {
      "type": "string",
      "description": "Human-readable summary of load results"
    },
    "validation_status": {
      "type": "string",
      "enum": ["complete_success", "partial_load", "load_failures", "unknown"],
      "description": "Overall validation status of the batch"
    },
    "created_by": {
      "type": "string",
      "description": "User/system that initiated the load"
    }
  },
  "required": [
    "batch_id",
    "batch_start_time",
    "batch_end_time",
    "source",
    "job_id",
    "target_table",
    "files_processed",
    "files_loaded",
    "files_failed",
    "files_missing",
    "files_successful",
    "total_records_processed",
    "total_records_loaded",
    "total_records_failed",
    "total_records_missing",
    "batch_duration_ms",
    "total_file_size_bytes",
    "error_codes",
    "error_summary",
    "validation_status",
    "created_by"
  ],
  "definitions": {
    "error_code": {
      "type": "string",
      "enum": [
        "E001",
        "E002", 
        "E003",
        "E004",
        "E005",
        "E006",
        "E007",
        "E999"
      ],
      "description": "Standardized error codes: E001=FILE_NOT_FOUND, E002=PERMISSION_DENIED, E003=INVALID_FORMAT, E004=SCHEMA_MISMATCH, E005=NETWORK_ERROR, E006=TIMEOUT, E007=MEMORY_ERROR, E999=UNKNOWN_ERROR"
    }
  }
} 